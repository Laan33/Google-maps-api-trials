<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <title>Document</title>
    <style>
        table {
            border-collapse: collapse;
        }
        th {
            background-color: lightgreen;
            border: 1px solid white;
        }
        td {
            background-color: lightgrey;
            border: 1px solid white;
        }
    </style>
</head>
<body>
    <div id="enterDetails">
        <h1>Enter details</h1>

        <h4>ID</h4>
        <input id="enterID" type="text">

        <h4>Name</h4>
        <input id="enterName" type="text">

        <h4>Location</h4>
        <input id="enterLoc" type="number"> <br><br>

        <button id="insert">INSERT</button><br><br>
    </div>

    <div class ="container mt-3">
        <table class="table table-hover">
            <thead>
                <th>User</th>
                <th>Name</th>
                <th>Location</th>
            </thead>
            <tbody id="tbody1">

            </tbody>
        </table>
    </div>

    <script type="module">

        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-analytics.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyAsePt3CWOF65D-VXLiHzgALnyaV0GyEtE",
            authDomain: "dumplingsproject-85128.firebaseapp.com",
            databaseURL: "https://dumplingsproject-85128-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "dumplingsproject-85128",
            storageBucket: "dumplingsproject-85128.appspot.com",
            messagingSenderId: "133458339612",
            appId: "1:133458339612:web:0f97c2332babdc0f1c3cd9",
            measurementId: "G-MFW22SPKZB"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);

        import {getDatabase, ref, get, set, child, update, remove}
            from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";


        const db = getDatabase();

        var enterID = document.querySelector("#enterID");
        var enterName = document.querySelector("#enterName");
        var enterLoc = document.querySelector("#enterLoc");

        var insertBtn = document.querySelector("#insert");


        function InsertData() {
            if (!enterID.value || !enterName.value || !enterLoc.value) {
                alert("Please enter all required fields.");
                return;
            }
            set(ref(db, "People/" + enterID.value), {
                Name: enterName.value,
                ID: enterID.value,
                Location: enterLoc.value,
            })
                .then(() => {
                    // alert("Data added successfully");
                })
                .catch((error) => {
                    alert(error);
                });
        }

        var pno=0;
        var tbody = document.getElementById("tbody1")

        function AddItem(name, location){
            let trow = tbody.insertRow(-1); // insert at end of table
            let td1 = document.createElement("td");
            let td2 = document.createElement("td");
            let td3 = document.createElement("td");

            td1.innerHTML = ++pno;
            td2.innerHTML = name;
            td3.innerHTML = location;

            trow.appendChild(td1);
            trow.appendChild(td2);
            trow.appendChild(td3);

            // tbody.appendChild(trow);
        }


        function AddAllToTable(ThePeople){
            pno=0;
            tbody.innerHTML="";
            ThePeople.forEach(element =>{
                if (element.Name && element.Location) {
                    AddItem(element.Name, element.Location);
                }
            })
        }

        function GetData(){

            const dbref = ref(db);
            get(child(dbref,"People"))
                .then((snapshot)=>{
                    var people = [];
                    snapshot.forEach(childSnapshot =>{
                        people.push(childSnapshot.val());
                    });
                    AddAllToTable(people);
            })
        }

        // window.onload = GetData;
        insertBtn.addEventListener('click', InsertData);
        insertBtn.addEventListener('click', GetData);

    </script>
</body>
</html>